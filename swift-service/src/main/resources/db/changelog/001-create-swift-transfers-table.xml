<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.20.xsd">

    <changeSet id="001-create-swift-transfers-table" author="swift-service">
        <createTable tableName="swift_transfers">
            <!-- Primary Key -->
            <column name="id" type="BIGSERIAL" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>

            <!-- Transaction Reference -->
            <column name="transaction_reference" type="VARCHAR(16)">
                <constraints nullable="false" unique="true"/>
            </column>

            <!-- Message Type -->
            <column name="message_type" type="VARCHAR(6)" defaultValue="MT103">
                <constraints nullable="false"/>
            </column>

            <!-- Bank Operation Code -->
            <column name="bank_operation_code" type="VARCHAR(4)" defaultValue="CRED"/>

            <!-- Value Date, Currency, Amount -->
            <column name="value_date" type="DATE">
                <constraints nullable="false"/>
            </column>
            <column name="currency" type="VARCHAR(3)">
                <constraints nullable="false"/>
            </column>
            <column name="amount" type="DECIMAL(19,2)">
                <constraints nullable="false"/>
            </column>

            <!-- Ordering Customer -->
            <column name="ordering_customer_name" type="VARCHAR(140)">
                <constraints nullable="false"/>
            </column>
            <column name="ordering_customer_address" type="VARCHAR(140)"/>
            <column name="ordering_customer_account" type="VARCHAR(34)"/>

            <!-- Sender's Bank -->
            <column name="sender_bic" type="VARCHAR(11)">
                <constraints nullable="false"/>
            </column>
            <column name="sender_name" type="VARCHAR(140)">
                <constraints nullable="false"/>
            </column>

            <!-- Correspondent Bank -->
            <column name="correspondent_bic" type="VARCHAR(11)"/>
            <column name="correspondent_name" type="VARCHAR(140)"/>
            <column name="correspondent_account" type="VARCHAR(34)"/>

            <!-- Beneficiary's Bank -->
            <column name="beneficiary_bank_bic" type="VARCHAR(11)">
                <constraints nullable="false"/>
            </column>
            <column name="beneficiary_bank_name" type="VARCHAR(140)"/>

            <!-- Beneficiary Customer -->
            <column name="beneficiary_name" type="VARCHAR(140)">
                <constraints nullable="false"/>
            </column>
            <column name="beneficiary_address" type="VARCHAR(140)"/>
            <column name="beneficiary_account" type="VARCHAR(34)">
                <constraints nullable="false"/>
            </column>

            <!-- Remittance Information -->
            <column name="remittance_info" type="VARCHAR(140)"/>

            <!-- Charge Type -->
            <column name="charge_type" type="VARCHAR(3)" defaultValue="SHA">
                <constraints nullable="false"/>
            </column>

            <!-- Fee Calculation -->
            <column name="fixed_fee" type="DECIMAL(19,2)"/>
            <column name="percentage_fee" type="DECIMAL(19,4)"/>
            <column name="total_fee" type="DECIMAL(19,2)"/>

            <!-- MT103 Message -->
            <column name="mt103_message" type="TEXT"/>

            <!-- Status -->
            <column name="status" type="VARCHAR(20)" defaultValue="PENDING">
                <constraints nullable="false"/>
            </column>
            <column name="status_reason" type="VARCHAR(500)"/>

            <!-- Compliance -->
            <column name="ofac_checked" type="BOOLEAN" defaultValueBoolean="false"/>
            <column name="sanctions_checked" type="BOOLEAN" defaultValueBoolean="false"/>
            <column name="compliance_cleared" type="BOOLEAN" defaultValueBoolean="false"/>
            <column name="compliance_notes" type="VARCHAR(500)"/>

            <!-- Settlement -->
            <column name="settlement_date" type="DATE"/>
            <column name="settlement_reference" type="VARCHAR(35)"/>

            <!-- Audit Fields -->
            <column name="created_at" type="TIMESTAMP" defaultValueComputed="CURRENT_TIMESTAMP">
                <constraints nullable="false"/>
            </column>
            <column name="updated_at" type="TIMESTAMP"/>
            <column name="version" type="BIGINT" defaultValue="0"/>
        </createTable>

        <!-- Indexes -->
        <createIndex tableName="swift_transfers" indexName="idx_reference">
            <column name="transaction_reference"/>
        </createIndex>

        <createIndex tableName="swift_transfers" indexName="idx_sender_bic">
            <column name="sender_bic"/>
        </createIndex>

        <createIndex tableName="swift_transfers" indexName="idx_beneficiary_bic">
            <column name="beneficiary_bank_bic"/>
        </createIndex>

        <createIndex tableName="swift_transfers" indexName="idx_status">
            <column name="status"/>
        </createIndex>

        <createIndex tableName="swift_transfers" indexName="idx_value_date">
            <column name="value_date"/>
        </createIndex>
    </changeSet>

</databaseChangeLog>
